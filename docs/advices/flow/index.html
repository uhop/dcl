
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>flow - DCL</title>
  <meta name="author" content="Eugene Lazutkin">

  
  <meta name="description" content="flow Jul 29th, 2012 1:54 pm flow returns an instance of an object, which can be used as an AOP advice
to track control flow. It can indicate if a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.dcljs.org/docs/advices/flow">
  <link href="/favicon.ico" rel="icon">
  <link href="/fav144.png" rel="apple-touch-icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="DCL" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33552109-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    >
  <header role="banner"><hgroup>
  <h1><a href="/">DCL</a></h1>
  
    <h2>An elegant OOP with mixins + AOP for JavaScript.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="www.dcljs.org">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
	<li><a href="/docs">Documentation</a></li>
	<li><a href="/support">Support</a></li>
	<li><a href="http://github.com/uhop/dcl">Code</a></li>
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">flow</h1>
    <p class="meta">




<time class='entry-date' datetime='2012-07-29T13:54:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>1:54 pm</span></time></p>
  </header>
  
  <p><code>flow</code> returns an instance of an object, which can be used as an AOP advice
to track control flow. It can indicate if a certain method was called while
in a control flow of another method.</p>

<p>This advice can be used for debugging, and for implementing flow-specific
behavior.</p>

<p>It can be included with following commands:</p>

<figure class='code'><figcaption><span>Include flow </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// node.js</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">flow</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dcl/advices/flow&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// AMD (code)</span>
</span><span class='line'><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dcl/advices/flow&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">flow</span><span class="p">){</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// AMD (definition)</span>
</span><span class='line'><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;dcl/advices/flow&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">flow</span><span class="p">){</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Description</h2>

<p>This module allows to mark a flow (calls to specific methods) with a unique name,
and check if those methods were part of our call stack at the moment.
Additionally it provides counters to see how many times those methods were called
in this flow to detect recusions.</p>

<p>For example, we can define two distinct flows that are triggered by different methods
to collect information, and to distribute it. Other methods that are called in
the flow of those trigger methods, can detect what is going on, and behave differently
in different flows. One good examples is a flow-specific profiling, when we run
counters and timers only for specific types of flow.</p>

<p>This is an API of <code>flow</code> module:</p>

<figure class='code'><figcaption><span>flow </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="kd">var</span> <span class="nx">flow</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">advice</span><span class="o">:</span>   <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){...},</span>
</span><span class='line'>  <span class="nx">inFlowOf</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">){...},</span>
</span><span class='line'>  <span class="nx">getStack</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){...},</span>
</span><span class='line'>  <span class="nx">getCount</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){...}</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<h3><code>advice(name)</code></h3>

<p>Returns an advice object, which marks a call to a method with a flow <code>name</code>.
It can be used directly with <a href="/docs/dcl_js/advise">dcl.advise()</a> or
<a href="/docs/advise_js/advise">advise()</a>.</p>

<p>There is no special requirements on <code>name</code>. Usually it is selected to be a unique
and descriptive string.</p>

<p>It is possible to reuse the same flow name for different methods.</p>

<h3><code>inFlowOf(name)</code></h3>

<p>Returns a falsy value, if <code>name</code> flow is not in our call stack. Otherwise it returns
a non-zero number, which indicates how many times it is encountered in our call stack.</p>

<h3><code>getStack()</code></h3>

<p>Returns an array of flow names encountered to this point.</p>

<h3><code>getCount()</code></h3>

<p>Returns a dictionary of flow counters, where a flow name serves as a key,
and a counter (how many times this flow was encountered in our call stack)
as a value.</p>

<h2>Examples</h2>

<p>Class-level example:</p>

<figure class='code'><figcaption><span>flow class-level example </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// our &quot;class&quot;:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Ackermann</span> <span class="o">=</span> <span class="nx">dcl</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">declaredName</span><span class="o">:</span> <span class="s2">&quot;Ackermann&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">m0</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">n0</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">a</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">n</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">m0</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">n0</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// our advised version:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">AdvisedAckermann</span> <span class="o">=</span> <span class="nx">dcl</span><span class="p">(</span><span class="nx">Ackermann</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">declaredName</span><span class="o">:</span> <span class="s2">&quot;AdvisedAckermann&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">m0</span><span class="o">:</span> <span class="nx">dcl</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">advice</span><span class="p">(</span><span class="s2">&quot;m0&quot;</span><span class="p">)),</span>
</span><span class='line'>  <span class="nx">n0</span><span class="o">:</span> <span class="nx">dcl</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">advice</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">)),</span>
</span><span class='line'>  <span class="nx">a</span><span class="o">:</span>  <span class="nx">dcl</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">advice</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)),</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// our instrumented version:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">InstrumentedAckermann</span> <span class="o">=</span> <span class="nx">dcl</span><span class="p">(</span>
</span><span class='line'>  <span class="p">[</span><span class="nx">Ackermann</span><span class="p">,</span> <span class="nx">AdvisedAckermann</span><span class="p">],</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="nx">m0</span><span class="o">:</span> <span class="nx">dcl</span><span class="p">.</span><span class="nx">around</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">sup</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;m0 - a() was called: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">inFlowOf</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;m0 - n0() was called: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">inFlowOf</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">getStack</span><span class="p">();</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">previous</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;(none)&quot;</span><span class="p">;</span>
</span><span class='line'>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;m0 - called directly from: &quot;</span> <span class="o">+</span> <span class="nx">previous</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nx">sup</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">})</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InstrumentedAckermann</span><span class="p">();</span>
</span><span class='line'><span class="nx">x</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Object-level example:</p>

<figure class='code'><figcaption><span>flow object-level example </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// our &quot;class&quot;:</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">Ackermann</span> <span class="o">=</span> <span class="nx">dcl</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">declaredName</span><span class="o">:</span> <span class="s2">&quot;Ackermann&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">m0</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">n0</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">){</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span><span class='line'>  <span class="p">},</span>
</span><span class='line'>  <span class="nx">a</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">n</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">m0</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">n0</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ackermann</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// advise with flow</span>
</span><span class='line'><span class="nx">advise</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="s2">&quot;m0&quot;</span><span class="p">,</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="s2">&quot;m0&quot;</span><span class="p">));</span>
</span><span class='line'><span class="nx">advise</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="s2">&quot;n0&quot;</span><span class="p">,</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">));</span>
</span><span class='line'><span class="nx">advise</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span>  <span class="nx">flow</span><span class="p">.</span><span class="nx">advise</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// our special advise:</span>
</span><span class='line'><span class="nx">advise</span><span class="p">.</span><span class="nx">around</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="s2">&quot;m0&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sup</span><span class="p">){</span>
</span><span class='line'>  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;m0 - a() was called: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">inFlowOf</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;m0 - n0() was called: &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">inFlowOf</span><span class="p">(</span><span class="s2">&quot;n0&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="mi">0</span><span class="p">));</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">getStack</span><span class="p">();</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">previous</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s2">&quot;(none)&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;m0 - called directly from: &quot;</span> <span class="o">+</span> <span class="nx">previous</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">sup</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">n</span><span class="p">);</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">x</span><span class="p">.</span><span class="nx">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>In both case the output would be:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>m0 - a() was called: 3
</span><span class='line'>m0 - n0() was called: 1
</span><span class='line'>m0 - called directly from: a
</span><span class='line'>m0 - a() was called: 2
</span><span class='line'>m0 - n0() was called: 0
</span><span class='line'>m0 - called directly from: a</span></code></pre></td></tr></table></div></figure>


  
    <footer>
      <p class="meta">
        
        




<time class='entry-date' datetime='2012-07-29T13:54:00-05:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>29</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>1:54 pm</span></time>
        
      </p>
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.dcljs.org/docs/advices/flow/index.html" data-via="uhop" data-counturl="http://www.dcljs.org/docs/advices/flow/index.html" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
	<h1>Current Status</h1>
	<p><a href="http://travis-ci.org/uhop/dcl"><img src="https://secure.travis-ci.org/uhop/dcl.png?branch=master" alt="Build Status"></a></p>
</section><section>
  <h1>Social</h1>
  <p><code>dcl</code> on <a href="https://plus.google.com/+dcljs-oop-aop" rel="publisher">Google+</a>.<br>
  <code>dcl</code> on <a href="https://twitter.com/dcl_js">Twitter</a>.</p>
</section>

<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/109185893580826547067?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/06/1-dot-1-3-micro-update/">1.1.3: micro update</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/12/28/1-dot-1-2-technical-release/">1.1.2: technical release</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/05/micro-update-1-dot-1-1/">Micro update: 1.1.1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/04/1-dot-1-legacy/">1.1: legacy</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/24/1-dot-0-4-added-to-bower/">1.0.4: added to Bower</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Eugene Lazutkin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">var sc_project=8158109, sc_invisible= 1, sc_security="13e920e4";</script>
<script type="text/javascript" src="http://www.statcounter.com/counter/counter.js"></script>
<noscript>
	<div class="statcounter">
		<a title="tumblr hit tracking tool" href="http://statcounter.com/tumblr/" target="_blank">
			<img class="statcounter" src="http://c.statcounter.com/8158109/0/13e920e4/1/" alt="tumblr hit tracking tool">
		</a>
	</div>
</noscript>
<!-- End of StatCounter Code for Default Guide -->
<div><a href="https://github.com/uhop/dcl"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub"></a></div>

</body>
</html>

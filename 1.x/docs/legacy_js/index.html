
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>legacy.js - DCL</title>
  <meta name="author" content="Eugene Lazutkin">

  
  <meta name="description" content="legacy.js Oct 4th, 2013 7:33 pm Version 1.x legacy.js is a drop-in replacement for mini.js (added in dcl 1.1.0), which supports legacy browsers ( &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.dcljs.org/1.x/docs/legacy_js">
  <link href="/favicon.ico" rel="icon">
  <link href="/fav144.png" rel="apple-touch-icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="DCL" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33552109-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    >
  <header role="banner"><hgroup>
  <h1><a href="/">DCL</a></h1>
  
    <h2>An elegant OOP with mixins + AOP for JavaScript.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="www.dcljs.org">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/docs/">Docs</a></li>
	<li><a href="/support/">Support</a></li>
	<li><a href="/blog/archives/">Archives</a></li>
	<li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">legacy.js</h1>
    <p class="meta">




<time class='entry-date' datetime='2013-10-04T19:33:00-05:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:33 pm</span></time></p>
  </header>
  
  <p><em>Version 1.x</em></p>

<p><code>legacy.js</code> is a drop-in replacement for <a href="/1.x/docs/mini_js/">mini.js</a> (added in <code>dcl</code> 1.1.0), which supports legacy browsers (tested with IE8). It has the same API, and the same functionality.</p>

<p>While it is possible to use <code>legacy.js</code> instead of <a href="/1.x/docs/mini_js/">mini.js</a> with <code>node.js</code> and modern browsers, it is not advised, because <code>legacy.js</code> is slower than <a href="/1.x/docs/mini_js/">mini.js</a>.</p>

<p>This module is meant to be used as a substitute for <a href="/1.x/docs/mini_js/">mini.js</a>. But there is one scenario when it can be used on its own: as the only <code>dcl</code> module in a small project. In this case, when no other <code>dcl</code> modules are used, it can be included directly from JavaScript:</p>

<figure class='code'><figcaption><span>Include legacy </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="c1">// node.js</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">dcl</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;dcl/legacy&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// AMD (code)</span>
</span><span class='line'><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;dcl/legacy&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dcl</span><span class="p">){</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// AMD (definition)</span>
</span><span class='line'><span class="nx">define</span><span class="p">([</span><span class="s2">&quot;dcl/legacy&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dcl</span><span class="p">){</span>
</span><span class='line'>  <span class="p">...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Background</h2>

<p>When <code>dcl</code> was released originally, it supported only modern environments. The major problem with legacy environments was not their obsolescence or backwardness, or lack of certain features, but shameful bugs in their implementation of JavaScript. The biggest of them is a <code>for in</code> loop bug, which skips some property names.</p>

<p>In general it means that the normal <code>for in</code> loop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">object</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span class='line'>  <span class="c1">// do something</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Should be approximated like that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">object</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span class='line'>  <span class="c1">// do something</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">hidden</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hasOwnProperty&quot;</span><span class="p">,</span> <span class="s2">&quot;valueOf&quot;</span><span class="p">,</span> <span class="s2">&quot;isPrototypeOf&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;propertyIsEnumerable&quot;</span><span class="p">,</span> <span class="s2">&quot;toLocaleString&quot;</span><span class="p">,</span> <span class="s2">&quot;toString&quot;</span><span class="p">,</span> <span class="s2">&quot;constructor&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">hidden</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">){</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">hidden</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||</span> <span class="o">!</span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)){</span>
</span><span class='line'>    <span class="c1">// do something like above</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Obviously such approximation is inexact, and more expensive space-wise, and processor-wise. This is why it was rejected initially. Later on a legacy version of <a href="/1.x/docs/mini_js/">mini.js</a> was designed as a replacement, keeping the canonical version of <code>dcl</code> small and fast, yet providing an option for legacy environments (older version of IE).</p>

<h2>FAQ</h2>

<h3>How can I substitute <code>mini.js</code> with <code>legacy.js</code> conditionally?</h3>

<p>First of all, you need to do it only in a browser environment. Over there an AMD loader will help us. For example, <code>tests\tests.html</code> uses a conditional comment technique targeting legacy IE browsers specifically:</p>

<figure class='code'><figcaption><span>Loading legacy.js conditionally </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='js'><span class='line'><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">paths</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">domReady</span><span class="o">:</span> <span class="s2">&quot;https://raw.github.com/requirejs/domReady/latest/domReady&quot;</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="cm">/*@cc_on</span>
</span><span class='line'><span class="cm">    if(@_jscript_version &lt; 9){</span>
</span><span class='line'><span class="cm">        paths[&quot;../mini&quot;]  = &quot;../legacy&quot;;</span>
</span><span class='line'><span class="cm">        paths[&quot;dcl/mini&quot;] = &quot;dcl/legacy&quot;;</span>
</span><span class='line'><span class="cm">    }</span>
</span><span class='line'><span class="cm">    @*/</span>
</span><span class='line'>    <span class="nx">require</span><span class="p">.</span><span class="nx">config</span><span class="p">({</span>
</span><span class='line'>        <span class="nx">baseUrl</span><span class="o">:</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span>
</span><span class='line'>        <span class="nx">packages</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>            <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;heya-unit&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">location</span><span class="o">:</span> <span class="s2">&quot;../node_modules/heya-unit&quot;</span><span class="p">},</span>
</span><span class='line'>            <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;heya-ice&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">location</span><span class="o">:</span> <span class="s2">&quot;../node_modules/heya-unit/node_modules/heya-ice&quot;</span><span class="p">},</span>
</span><span class='line'>            <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;heya-unify&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="nx">location</span><span class="o">:</span> <span class="s2">&quot;../node_modules/heya-unit/node_modules/heya-unify&quot;</span><span class="p">}</span>
</span><span class='line'>        <span class="p">],</span>
</span><span class='line'>        <span class="nx">paths</span><span class="o">:</span> <span class="nx">paths</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">})();</span>
</span><span class='line'><span class="nx">require</span><span class="p">([</span><span class="s2">&quot;require&quot;</span><span class="p">,</span> <span class="s2">&quot;./tests&quot;</span><span class="p">,</span> <span class="s2">&quot;domReady!&quot;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">){</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./tests&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see how the script manipulates <code>paths</code> of <code>require.config</code> to load <code>legacy.js</code> instead of <a href="/1.x/docs/mini_js/">mini.js</a> on IE &lt; 9.</p>

<p>Read more about this technique in <a href="http://msdn.microsoft.com/en-us/library/ie/8ka90k2e(v=vs.94).aspx">MSDN: @cc_on</a>.</p>

<h3>Can I just replace <code>mini.js</code> with <code>legacy.js</code> in my own IE-specific application?</h3>

<p>Yes. But remember that when you handle 3rd-party files manually, you are on your own, and all mistakes are yours.</p>

<h3>I built all my JS files into two layers: normal, and legacy. How can I load them conditionally?</h3>

<p>One way to do it is to use HTML-level conditional comments supported by IE. Read more about this technique in <a href="http://msdn.microsoft.com/en-us/library/ms537512(VS.85).aspx">MSDN: About conditional comments</a>.</p>

<h3>Does it work on IE6?</h3>

<p>Unlikely &ndash; it was never tested on IE6, and so far no requests were made for such environment. But you can always try.</p>

<p>Gentle reader, be warned: IE6 had even more implementation bugs than IE7/IE8.</p>

  
    <footer>
      <p class="meta">
        
        




<time class='entry-date' datetime='2013-10-04T19:33:00-05:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2013</span></span> <span class='time'>7:33 pm</span></time>
        
      </p>
      
        

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Social</h1>
  <p><code>dcl</code> on <a href="https://plus.google.com/+dcljs-oop-aop" rel="publisher">Google+</a>.<br>
  <code>dcl</code> on <a href="https://twitter.com/dcl_js">Twitter</a>.</p>
</section>

<section class="googleplus googleplus-hidden">
  <h1>
    <a href="https://plus.google.com/109185893580826547067?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>


<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/01/18/dcl6-is-coming/">dcl6 is coming</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/07/19/using-dcl-with-es6/">Using dcl with ES6</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/07/19/new-addition-registry/">New addition: registry</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/09/new-major-release-2-dot-0/">New major release: 2.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/06/1-dot-1-3-micro-update/">1.1.3: micro update</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Eugene Lazutkin -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">var sc_project=8158109, sc_invisible= 1, sc_security="13e920e4";</script>
<script type="text/javascript" src="http://www.statcounter.com/counter/counter.js"></script>
<noscript>
	<div class="statcounter">
		<a title="tumblr hit tracking tool" href="http://statcounter.com/tumblr/" target="_blank">
			<img class="statcounter" src="http://c.statcounter.com/8158109/0/13e920e4/1/" alt="tumblr hit tracking tool">
		</a>
	</div>
</noscript>
<!-- End of StatCounter Code for Default Guide -->


</body>
</html>
